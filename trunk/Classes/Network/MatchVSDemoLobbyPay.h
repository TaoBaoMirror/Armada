#ifndef __FORMAIN__
#define __FORMAIN__

#if (defined(WIN32) || defined(_WIN32) || defined(__WIN32__) || defined(__NT__))
#include <winsock2.h>
#include <windows.h>

#else // defined(__linux__) || defined(__linux)
//#includ<unistd.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <dirent.h>
#include <cstddef>
#include <string.h>
#include <stdlib.h>
#endif



#include <stdio.h>
#include <stdlib.h>
#include "MatchVSBase.h"
#include "MatchVSLobby.h"
#include "MatchVSPay.h"
#include "cocos2d.h"
#include "CommonMutex.h"
#include "MatchVSDemoCommon.h"

USING_NS_CC;




typedef struct randpro {
	ms_int32_t size;
	ms_int32_t neti;
	ms_int32_t nums;
}randpro;

class  MatchVSDemoLobbyCallback : public CMatchVSLobbyCallback {
public:
	MatchVSDemoLobbyCallback() {}
	~MatchVSDemoLobbyCallback() {}
	std::string *hwold;
	static int i;


	/*********************************************************************************************************
	** åç§°:	onRoomInBack
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼Œå½“å‰ç”¨æˆ·åŠ å…¥æˆ¿é—´ç»“æœé€šçŸ¥
	** è¾“å…¥:	i32RoomIDï¼šæˆ¿é—´ID
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onRoomInBack(ms_int32_t i32RoomID);

	/*********************************************************************************************************
	** åç§°:	onUserRoomInBack
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼Œå…¶ä»–ç”¨æˆ·åŠ å…¥æˆ¿é—´ç»“æœé€šçŸ¥
	** è¾“å…¥:	i32RoomIDï¼šæˆ¿é—´ID, i32UserIDï¼šç”¨æˆ·ID
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onUserRoomInBack(ms_int32_t i32RoomID, ms_int32_t i32UserID);

	/*********************************************************************************************************
	** åç§°:	onLoginBack
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼Œç™»å½•ç»“æœé€šçŸ¥
	** è¾“å…¥:	pRspï¼šæŒ‡å‘MatchVSLoginRspçš„æŒ‡é’ˆã€?
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onLoginBack(MatchVSLoginRsp *pRsp);

	/*********************************************************************************************************
	** åç§°:	onRoomInBack
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼Œç”¨æˆ·é€€å‡ºæˆ¿é—´ç»“æœé€šçŸ¥
	** è¾“å…¥:	æ—?
	** è¾“å‡ºï¼?æ—?
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onRoomOutBack();

	/*********************************************************************************************************
	** åç§°:	onUserRoomInBack
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼Œå…¶ä»–ç”¨æˆ·é€€å‡ºç»“æœé€šçŸ¥
	** è¾“å…¥:	i32UserIDï¼šç”¨æˆ·ID
	** è¾“å‡º:	æ—?
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onUserRoomOutBack(ms_int32_t i32UserID);

	/*********************************************************************************************************
	** åç§°:	onErrBack
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼Œå¤§å…é”™è¯¯æ¶ˆæ?
	** è¾“å…¥:	i32Retï¼šçŠ¶æ€ç   ï¼?pMsgï¼šæŒ‡å‘ms_str_tçš„æŒ‡é’ˆï¼ˆé”™è¯¯ä¿¡æ¯ï¼?
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onErrBack(ms_int32_t i32Ret, ms_str_t *pMsg);

	/*********************************************************************************************************
	** åç§°:	onRecv
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼?/æ¥æ”¶ç”¨æˆ·æ•°æ®ï¼?userid 0 æ¥è‡ªæ‰€æœ‰ç”¨æˆ·ï¼ˆæœåŠ¡å™¨ä¸­è½¬ï¼‰
	** è¾“å…¥:	i32UserIDï¼šç”¨æˆ·IDï¼? pMsgï¼šæŒ‡å‘ms_str_tçš„æŒ‡é’ˆï¼ˆè¿”å›çš„æ•°æ®ï¼‰
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onRecv(ms_int32_t i32UserID, ms_str_t *pMsg);

	/*********************************************************************************************************
	** åç§°:	onRecvReliable
	** æè¿°:	å¯é æ¶ˆæ¯å›è°ƒæŒ‡é’ˆç±»å‹ï¼?/æ¥æ”¶ç”¨æˆ·æ•°æ®ï¼?userid 0 æ¥è‡ªæ‰€æœ‰ç”¨æˆ·ï¼ˆæœåŠ¡å™¨ä¸­è½¬ï¼‰
	** è¾“å…¥:	i32UserIDï¼šç”¨æˆ·IDï¼? pMsgï¼šæŒ‡å‘ms_str_tçš„æŒ‡é’ˆï¼ˆè¿”å›çš„æ•°æ®ï¼‰
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onRecvReliable(ms_int32_t i32UserID, ms_str_t *pMsg);

	/*********************************************************************************************************
	** åç§°:	onGameReady
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼Œå½“å‰ç”¨æˆ·å‡†å¤‡å¥½
	** è¾“å…¥:	i32RoundIDï¼šåœºæ¬?
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onGameReady();

	/*********************************************************************************************************
	** åç§°:	onUserGameReady
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼Œå…¶ä»–ç”¨æˆ·å‡†å¤‡å¥½
	** è¾“å…¥:	i32RoomIDï¼šæˆ¿é—´ID
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onUserGameReady(ms_int32_t i32UserID);

	/*********************************************************************************************************
	** åç§°:	onCancelReady
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼Œå½“å‰ç”¨æˆ·å–æ¶ˆæ¸¸æˆå‡†å¤?
	** è¾“å…¥:	æ—?
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onCancelReady();

	/*********************************************************************************************************
	** åç§°:	onUserCancelReady
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼Œå…¶ä»–æ¸¸æˆç”¨æˆ·å–æ¶ˆæ¸¸æˆå‡†å¤?
	** è¾“å…¥:	i32UserIDï¼?ç”¨æˆ·ID
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onUserCancelReady(ms_int32_t i32UserID);

	/*********************************************************************************************************
	** åç§°:	onGameStart
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼?/å½“å‰ç”¨æˆ·æ¸¸æˆå¼€å§?
	** è¾“å…¥:	i32RoundIDï¼šåœºæ¬¡ID
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onGameStart(ms_int64_t i32RoundID);

	/*********************************************************************************************************
	** åç§°:	onGameOver
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼?/æ¸¸æˆç»“æŸåˆ†æ•°ä¸‹å‘
	** è¾“å…¥:	pScoreï¼šæŒ‡å‘MatchVSScoreçš„æŒ‡é’ˆï¼Œ i32Numï¼šåˆ†æ•?
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onGameOver(MatchVSScore  *ppScore, ms_int32_t i32Num);

	/*********************************************************************************************************
	** åç§°:	onRoomOwnerChanged
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼Œæ¢æˆ¿é—´owner
	** è¾“å…¥:	i32UserIDï¼šæ–°ä¸»äººçš„ID
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onRoomOwnerChanged(ms_int32_t   i32UserID);

	/*********************************************************************************************************
	** åç§°:	onDelayFrame
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼?/é’ˆå¯¹å¸§åŒæ­¥å¼€å§‹æ¸¸æˆå‰éœ€è¦çš„å»¶è¿Ÿä¸ŠæŠ¥å†³å®šçš„ç§»åŠ¨çª—å£å¤§å°çš„æ¥å£.;
	** è¾“å…¥:	i32RoomIDï¼šæˆ¿é—´IDï¼?pDelayï¼šæŒ‡å‘MatchVSRoomDelayçš„æŒ‡é’?ï¼?i32Numï¼šå»¶æ—¶å¸§ä¸ªæ•°
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onDelayFrame(ms_int32_t i32RoomID, MatchVSRoomDelay *pDelay, ms_int32_t i32Num);

	/*********************************************************************************************************
	** åç§°:	onRoomDelay
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼?/æˆ¿é—´æ‰€æœ‰äººçš„ä¿¡å?
	** è¾“å…¥:	i32RoomIDï¼šæˆ¿é—´IDï¼?pDelayï¼šæŒ‡å‘MatchVSRoomDelayçš„æŒ‡é’? ï¼?i32Numï¼šçŠ¶æ€ç 
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onRoomDelay(ms_int32_t i32RoomID, MatchVSRoomDelay *pDelay, ms_int32_t i32Num);

	/*********************************************************************************************************
	** åç§°:	onRoomChange
	** æè¿°:	å›è°ƒæŒ‡é’ˆç±»å‹ï¼?//å½“å‰æˆ¿é—´åŠ¨æ€ï¼Œstatus: 0ç”¨æˆ·è¿›å…¥ status: 1ç”¨æˆ·å‡†å¤‡ï¼?2ç”¨æˆ·å¼€å§?
	** è¾“å…¥:	pUserStateï¼šæŒ‡å‘MatchVSUserStateç»“æ„ä½“ï¼Œi32Numï¼šçŠ¶æ€ç 
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onRoomChange(MatchVSUserState *pUserState, ms_int32_t i32Num);


	/*********************************************************************************************************
	** åç§°:	onMessage
	** æè¿°:	æ”¶åˆ°æ¶ˆæ¯å›è°ƒ
	** è¾“å…¥:	pMsgï¼?æ¶ˆæ¯
	** è¾“å‡º:
	** è¿”å›:	æ­£ç¡®ï¼?MATCHVS_OK  é”™è¯¯ ï¼?å…¶ä»–å€?
	*********************************************************************************************************/
	virtual ms_int32_t onMessage(ms_str_t* pMsg) { return MATCHVS_OK; };


};


class MatchVSDemoPayCallback : public CMatchVSPayCallback
{
public:
	MatchVSDemoPayCallback() {}
	~MatchVSDemoPayCallback() {}
	std::string *hwold;

	ms_int32_t onUseCDKey(CMatchVSPayProduct *pProducts, ms_int32_t i32Count);
	ms_int32_t onGetCDKey(CMatchVSPayCDKey *pCDKeys);
	ms_int32_t onGetMyBag(CMatchVSPayProduct *pProducts, ms_int32_t i32Count);
	ms_int32_t onSpend(CMatchVSPayProduct *pProducts, ms_int32_t i32Count);
	ms_int32_t onGetSpend(CMatchVSPayProduct *pProducts);
	ms_int32_t onExchange(CMatchVSPayProduct *pProducts, ms_int32_t i32Count);
	ms_int32_t onGetMyDiamond(ms_int32_t i32Count);
	ms_int32_t onCheckOrder(CMatchVSPayOrderResult *pOrderResult);
	ms_int32_t onPay(CMatchVSPayChargeResult *pChargeResult);
};


class MatchVSDemoLobbyPayBundle
{
public:

	~MatchVSDemoLobbyPayBundle();
	static MatchVSDemoLobbyPayBundle * getInstance();
	static void release();
	ms_int32_t demoSetAuth();
	const char * Handle(char const *pAct);
	const char * LobbyHandle(char const *pAct, int player);
	void set_str(std::string *str);
	ms_int32_t strkocmp(const char * str1, const char *str2);

	MatchVSAuth g_auth;
	MatchVSDemoLobbyCallback *cb_lobby;
	MatchVSDemoPayCallback *cb_pay;
	CMatchVSLobby *lobby;
	ms_str_t   token;
	std::string m_str;
	ms_int32_t userid;
	ms_int8_t *nowtoken;



private:
	MatchVSDemoLobbyPayBundle();
	static MatchVSDemoLobbyPayBundle * single;

};


#endif